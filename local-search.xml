<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Raid</title>
    <link href="/2022/09/12/p1-md/"/>
    <url>/2022/09/12/p1-md/</url>
    
    <content type="html"><![CDATA[<h1 id="Raid-ubuntu-16-04"><a href="#Raid-ubuntu-16-04" class="headerlink" title="Raid (ubuntu 16.04)"></a>Raid (ubuntu 16.04)</h1><p>（raid 0 ,raid 1）</p><h2 id="准备工作："><a href="#准备工作：" class="headerlink" title="准备工作："></a>准备工作：</h2><p> </p><h2 id="最少需要两块盘"><a href="#最少需要两块盘" class="headerlink" title="最少需要两块盘"></a>最少需要两块盘</h2><ul><li><p>这里使用的是&#x2F;dev&#x2F;sdb和&#x2F;dev&#x2F;sdc</p></li><li><p>通过lsblk命令查看。</p></li></ul><p> </p><h2 id="然后开始配置："><a href="#然后开始配置：" class="headerlink" title="然后开始配置："></a>然后开始配置：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">1，sudo mdadm --create --verbose /dev/md0 --level=0 --raid-devices=2 /dev/sdb /dev/sdc (raid 1只需要将level=1)<br></code></pre></td></tr></table></figure><h3 id="2-上条命令成功后可以查看-x2F-proc-x2F-mdstat文件。（可选）"><a href="#2-上条命令成功后可以查看-x2F-proc-x2F-mdstat文件。（可选）" class="headerlink" title="2,上条命令成功后可以查看&#x2F;proc&#x2F;mdstat文件。（可选）"></a>2,上条命令成功后可以查看&#x2F;proc&#x2F;mdstat文件。（可选）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /proc/mdstat<br></code></pre></td></tr></table></figure><p>(raid 1可以在这一步等待一下，使二者同步（会有进度条）)</p><h3 id="3-格式化md0并挂载："><a href="#3-格式化md0并挂载：" class="headerlink" title="3,格式化md0并挂载："></a>3,格式化md0并挂载：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>- sudo mkfs.ext4 -F /dev/md0<br><br>- sudo <span class="hljs-built_in">mkdir</span> -p /mnt/md0<br><br>- sudo mount /dev/md0 /mnt/md0<br></code></pre></td></tr></table></figure><h3 id="4-查看挂载是否成功（可选）"><a href="#4-查看挂载是否成功（可选）" class="headerlink" title="4,查看挂载是否成功（可选）"></a>4,查看挂载是否成功（可选）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">df</span> -h -x devtmpfs -x tmpfs<br></code></pre></td></tr></table></figure><h3 id="5-保存Array设置"><a href="#5-保存Array设置" class="headerlink" title="5,保存Array设置"></a>5,保存Array设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mdadm --detail --scan | sudo <span class="hljs-built_in">tee</span> -a /etc/mdadm/mdadm.conf<br><br>sudo update-initramfs -u<br></code></pre></td></tr></table></figure><p>使挂载后重启有效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/dev/md0 /mnt/md0 ext4 defaults,nofail,discard 0 0&#x27;</span> | sudo <span class="hljs-built_in">tee</span> -a /etc/fstab<br></code></pre></td></tr></table></figure><p>-————————————————————————————————————————–</p><h3 id="删除上述设置，并恢复两块盘："><a href="#删除上述设置，并恢复两块盘：" class="headerlink" title="删除上述设置，并恢复两块盘："></a>删除上述设置，并恢复两块盘：</h3><ul><li><p>1,sudo umount &#x2F;dev&#x2F;md0 (根据设置的设备名，可以cat &#x2F;proc&#x2F;mdstat查看)</p></li><li><p>2，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mdadm --stop /dev/md0<br><br>sudo mdadm --remove /dev/md0<br></code></pre></td></tr></table></figure></li><li><p>3,查看两块盘的信息（可选）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsblk<br></code></pre></td></tr></table></figure></li><li><p>4,清空盘的superblock</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mdadm --zero-superblock /dev/sdc<br><br>sudo mdadm --zero-superblock /dev/sdb<br></code></pre></td></tr></table></figure></li><li><p>5,注释配置信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">（1）sudo vim /etc/fstab<br><br>. . .<br><br>/dev/md0 /mnt/md0 ext4 defaults,nofail,discard 0 0<br><br>1.  sudo vim /etc/mdadm/mdadm.conf<br><br>. . .<br><br>\<span class="hljs-comment"># ARRAY /dev/md0 metadata=1.2 name=mdadmwrite:0 UUID=7261fb9c:976d0d97:30bc63ce:85e76e91</span><br><br> <br><br>\- 6,sudo update-initramfs -u<br><br>\---------------------------------------------------------------------------------------------------------------------------<br></code></pre></td></tr></table></figure></li></ul><p> </p><h3 id="raid5设置方法也一样。"><a href="#raid5设置方法也一样。" class="headerlink" title="raid5设置方法也一样。"></a>raid5设置方法也一样。</h3><p>只是最少需要三块盘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mdadm --create --verbose /dev/md0 --level=5 --raid-devices=3 /dev/sda /dev/sdb /dev/sdc<br></code></pre></td></tr></table></figure><p>其他无差别。</p><h3 id="raid6至少需要四块盘"><a href="#raid6至少需要四块盘" class="headerlink" title="raid6至少需要四块盘"></a>raid6至少需要四块盘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo mdadm --create --verbose /dev/md0 --level=6 --raid-devices=4 /dev/sda /dev/sdb /dev/sdc /dev/sdd<br></code></pre></td></tr></table></figure><h3 id="raid10至少需要三块盘"><a href="#raid10至少需要三块盘" class="headerlink" title="raid10至少需要三块盘"></a>raid10至少需要三块盘</h3><p>可以使用–layout指示布局，不过也可以不用。那么配置方法就与上述的一样。</p><p> </p><p>-————————————————————————————————————————–</p><p> </p><p> </p><p> </p><p><em>参考：How To Create RAID Arrays with mdadm on Ubuntu 16.04 | DigitalOcean</em></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
